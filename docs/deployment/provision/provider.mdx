---
title: "Providers Provisioning"
---

<Tip>For any questions or issues related to provider provisioning, please join our [Slack](https://slack.keephq.dev) community.</Tip>

Provider provisioning in Keep allows you to set up and manage data providers dynamically. This feature enables you to configure various data sources that Keep can interact with, such as monitoring systems, databases, or other services.

### Configuring Providers

To provision providers and deduplication rules for them, we can configure via the environment variable. This can be done in two ways:
1. Using `KEEP_PROVIDERS` environment variable which either contains a JSON string or a path to a JSON file that contains the providers configurations.
2. Using `KEEP_PROVIDERS_DIRECTORY` environment variable which contains a path to a directory that contains the providers configurations (configured via YAML files). This is the recommended approach.

<Note>
Keep does not allow to use both `KEEP_PROVIDERS` and `KEEP_PROVIDERS_DIRECTORY` environment variables at the same time.
</Note>

<Tip>Please note: Deduplication rules are not mandatory for provider distribution.</Tip>

### Providers provisioning using KEEP_PROVIDERS

Providers provisioning JSON example:
```json
{
  "keepVictoriaMetrics": {
    "type": "victoriametrics",
    "authentication": {
      "VMAlertHost": "http://localhost",
      "VMAlertPort": 1234
    },
    "deduplication_rules": {
      "deduplication rule name example 1": {
        "description": "deduplication rule name example 1",
        "fingerprint_fields": ["fingerprint", "source", "service"],
        "full_deduplication": true,
        "ignore_fields": ["name", "lastReceived"]
      },
      "deduplication rule name example 2": {
        "description": "deduplication rule name example 2",
        "fingerprint_fields": ["fingerprint", "source", "service"],
        "full_deduplication": false,
      }
    }
  },
  "keepClickhouse1": {
    "type": "clickhouse",
    "authentication": {
      "host": "http://localhost",
      "port": 1234,
      "username": "keep",
      "password": "keep",
      "database": "keep-db"
    }
  }
}
```

Spin up Keep with this `KEEP_PROVIDERS` value:
```json
# ENV
KEEP_PROVIDERS={"keepVictoriaMetrics":{"type":"victoriametrics","authentication":{"VMAlertHost":"http://localhost","VMAlertPort": 1234}},"keepClickhouse1":{"type":"clickhouse","authentication":{"host":"http://localhost","port":"4321","username":"keep","password":"1234","database":"keepdb"}}}
```

### Providers provisioning using KEEP_PROVIDERS_DIRECTORY

Specify the path to the directory containing the providers configurations:

```bash
# ENV
KEEP_PROVIDERS_DIRECTORY=/path/to/providers
```

The directory should contain YAML files with the providers configurations.

Example of a provider configuration YAML file:

```yaml
name: keepVictoriaMetrics
type: victoriametrics
authentication:
  VMAlertHost: http://localhost
  VMAlertPort: 1234
deduplication_rules:
  deduplication_rule_name_example_1:
    description: deduplication rule name example 1
    fingerprint_fields:
      - fingerprint
      - source
      - service
    full_deduplication: true
    ignore_fields:
      - name
      - lastReceived
```

### Supported Providers

Keep supports a wide range of provider types. Each provider type has its own specific configuration requirements.
To see the full list of supported providers and their detailed configuration options, please refer to our comprehensive provider documentation.


### Update Provisioned Providers

Keep uses a consistent process for updating provider configurations regardless of whether you use `KEEP_PROVIDERS` or `KEEP_PROVIDERS_DIRECTORY`.

#### Provisioning Process

When Keep starts or restarts, it follows these steps to manage provider configurations:

1. **Read Configurations**: Loads provider definitions from either the `KEEP_PROVIDERS` environment variable or YAML files in the `KEEP_PROVIDERS_DIRECTORY`.
2. **Calculate Configuration Hash**: Generates a hash of the current configurations to detect changes.
3. **Check for Changes**: Compares the new hash with the previously stored hash (in Redis or secret manager).
4. **Update When Changed**: If configurations have changed:
  - Backup the current state for potential rollback
  - Delete all existing provisioned providers
  - Provision new providers with their deduplication rules
  - If any errors occur during provisioning, automatically rollback to the previous state
5. **Skip When Unchanged**: If configurations haven't changed since the last startup, Keep skips the re-provisioning process to improve startup performance.
