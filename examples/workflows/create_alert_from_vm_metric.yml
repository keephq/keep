workflow:
  id: query-victoriametrics
  name: victoriametrics-alert-example
  description: victoriametrics
  triggers:
    - type: manual
  steps:
    - name: victoriametrics-step
      provider:
        config: "{{ providers.vm }}"
        type: victoriametrics
        with:
          query: avg(rate(process_cpu_seconds_total))
          queryType: query

  actions:
    - name: create-alert
      provider:
        type: keep
        with:
          if: "{{ value.1 }} > 0.0040"
          alert:
            name: "High CPU Usage"
            description: "[Single] CPU usage is high on the VM (created from VM metric)"
            severity: '{{ value.1 }} > 0.9 ? "critical" : {{ value.1 }} > 0.7 ? "warning" : "info"'
            labels:
              environment: production
              app: myapp
              service: api
              team: devops
              owner: alice
